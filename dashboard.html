<script>
  const params = new URLSearchParams(window.location.search);
  const userName = params.get("name");
  const token = params.get("token");

  if (!token) {
    alert("שגיאה: אין טוקן זיהוי");
    window.location.href = "index.html";
  }

  if (userName) {
    document.getElementById("userGreeting").innerText = `שלום, ${userName}`;
  }

  /* ⭐ טעינת בחירה אחרונה */
  window.onload = () => {
    const savedMain = localStorage.getItem("mainWarehouse");
    const savedFinished = localStorage.getItem("finishedWarehouse");

    if (savedMain) {
      document.getElementById("mainWarehouse").value = savedMain;
      handleMainWarehouse(); // מציג את תת המחסן אם צריך
    }

    if (savedFinished && savedMain === "finished") {
      document.getElementById("finishedWarehouse").value = savedFinished;
    }
  };

  function handleMainWarehouse() {
    const main = document.getElementById("mainWarehouse").value;

    /* ⭐ שמירת בחירה */
    localStorage.setItem("mainWarehouse", main);

    if (main === "finished") {
      document.getElementById("finishedSection").style.display = "block";
    } else {
      document.getElementById("finishedSection").style.display = "none";
    }
  }

  function goToReport() {
    const main = document.getElementById("mainWarehouse").value;
    const finished = document.getElementById("finishedWarehouse").value;

    /* ⭐ שמירת תת מחסן */
    if (main === "finished") {
      localStorage.setItem("finishedWarehouse", finished);
    }

    window.location.href =
      `report.html?token=${token}&name=${encodeURIComponent(userName)}&main=${main}&finished=${finished}`;
  }

  function logout() {
    window.location.href = "index.html";
  }
</script>

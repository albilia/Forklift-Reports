<script>

  // === כתובת ה־API ===
  const API_URL = "https://script.google.com/macros/s/AKfycbzDz9ktQAUhRbg5cF5Kfhh909CjGJW8A5fKKIG-HCZtCP5YRzAV3tInbg6kJJYn-pqr/exec";

  // === כניסה עם אימות אמיתי ===
  async function login() {
    const phone = document.getElementById("phoneInput").value.trim();

    if (phone.length < 9) {
      document.getElementById("loginError").innerText = "מספר לא תקין";
      return;
    }

    try {
      const response = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "login", phone }),
        headers: { "Content-Type": "application/json" }
      });

      const result = await response.text();

      if (result === "OK") {
        document.getElementById("login-screen").classList.add("hidden");
        document.getElementById("camera-screen").classList.remove("hidden");
      } else {
        document.getElementById("loginError").innerText = "אין הרשאה למספר זה";
      }

    } catch (err) {
      document.getElementById("loginError").innerText = "שגיאה בחיבור לשרת";
    }
  }

  // === פתיחת מצלמה ===
  function openCamera() {
    document.getElementById("cameraInput").click();
  }

  // === טיפול בתמונה ===
  document.getElementById("cameraInput").addEventListener("change", async function(event) {
    const file = event.target.files[0];
    if (!file) return;

    const forkliftName = document.getElementById("forkliftName").value.trim();

    if (!forkliftName) {
      alert("יש להזין שם מלגזן");
      return;
    }

    const reader = new FileReader();
    reader.onload = async function() {
      const base64Image = reader.result.split(",")[1];

      const payload = {
        image: base64Image,
        name: forkliftName
      };

      try {
        await fetch(API_URL, {
          method: "POST",
          body: JSON.stringify(payload),
          headers: { "Content-Type": "application/json" }
        });

        document.getElementById("camera-screen").classList.add("hidden");
        document.getElementById("success-screen").classList.remove("hidden");

      } catch (err) {
        alert("שגיאה בשליחה: " + err);
      }
    };

    reader.readAsDataURL(file);
  });

  // === חזרה לצילום נוסף ===
  function backToCamera() {
    document.getElementById("success-screen").classList.add("hidden");
    document.getElementById("camera-screen").classList.remove("hidden");
  }

</script>

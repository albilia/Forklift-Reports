<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>×”×¢×‘×¨×•×ª ××œ×’×–× ×™×</title>

  <!-- ×”×ª×××” ×œ××•×‘×™×™×œ ×•××¤×œ×™×§×¦×™×” -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="gilro-logo.png">
  <link rel="manifest" href="manifest.json">

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      margin: 0;
    }
    .logo {
      width: 160px;
      margin-top: 10px;
    }
    .hidden {
      display: none;
    }
    button {
      padding: 15px 25px;
      font-size: 18px;
      margin-top: 10px;
      cursor: pointer;
    }
    input, select {
      padding: 10px;
      font-size: 18px;
      width: 220px;
      margin-top: 10px;
    }
    footer {
      position: fixed;
      bottom: 25px; /* ××¢×œ×” ××ª ×”×©×•×¨×” */
      width: 100%;
      text-align: center;
      font-size: 15px;
      color: #444;
      font-weight: bold; /* ××•×“×’×© */
    }
  </style>
</head>
<body>

  <!-- ×œ×•×’×• -->
  <img src="logo.jpg" alt="×œ×•×’×• ×’×™×œ×¨×•" class="logo">

  <!-- ××¡×š ×–×™×”×•×™ -->
  <div id="login-screen">
    <h2>×”×¢×‘×¨×•×ª ××œ×’×–× ×™×</h2>
    <p>×”×–×Ÿ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×›×“×™ ×œ×”×™×›× ×¡:</p>
    <input id="phoneInput" type="tel" placeholder="05XXXXXXXX">
    <br><br>
    <button onclick="login()">×›× ×™×¡×”</button>
    <p id="loginError" style="color:red;"></p>
  </div>

  <!-- ××¡×š ×¦×™×œ×•× -->
  <div id="camera-screen" class="hidden">
    <h2>×¦×™×œ×•× ×“×•"×—×•×ª</h2>
    <p>×œ×—×¥ ×¢×œ ×”××™×™×§×•×Ÿ ×›×“×™ ×œ×¦×œ×</p>

    <!-- ××¦×œ××” -->
    <input id="cameraInput" type="file" accept="image/*" capture="environment" class="hidden">
    <button onclick="openCamera()">ğŸ“·</button>

    <!-- ×‘×—×™×¨×ª ××—×¡×Ÿ -->
    <h3>×‘×—×¨ ××—×¡×Ÿ:</h3>
    <select id="warehouseSelect">
      <option value="××—×¡×Ÿ 1">××—×¡×Ÿ 1</option>
      <option value="××—×¡×Ÿ 2">××—×¡×Ÿ 2</option>
      <option value="××—×¡×Ÿ 3">××—×¡×Ÿ 3</option>
    </select>

    <!-- ×©× ××œ×’×–×Ÿ -->
    <h3>×©× ××œ×’×–×Ÿ:</h3>
    <input id="forkliftName" type="text" placeholder="×”×›× ×¡ ×©×">
  </div>

  <!-- ××¡×š ××™×©×•×¨ -->
  <div id="success-screen" class="hidden">
    <h2>×”×•×¢×œ×” ×‘×”×¦×œ×—×” âœ”</h2>
    <button onclick="backToCamera()">×¦×œ× ×©×•×‘</button>
  </div>

  <!-- ×–×›×•×™×•×ª ×™×•×¦×¨×™× -->
  <footer>
    <strong>×¤×•×ª×— ×¢×œ ×™×“×™ × ×™×¡×™× ××œ×‘×™×œ×™×” Â© ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª</strong>
  </footer>

<script>

  // === 1. ×›×ª×•×‘×ª ×”Ö¾API ×©×œ×š ===
  const API_URL = "https://script.google.com/macros/s/AKfycbzfJm45tqLy-u5eaYIbxiH2Dbj4AymQXV_qqArP75uSoKet3voII4d9r2bAmenmJ6Z18Q/exec";  // â† ×œ×”×“×‘×™×§ ×›××Ÿ ××ª ×”Ö¾URL ×©×§×™×‘×œ×ª

  // === 2. ×›× ×™×¡×” ===
  function login() {
    const phone = document.getElementById("phoneInput").value.trim();

    if (phone.length < 9) {
      document.getElementById("loginError").innerText = "××¡×¤×¨ ×œ× ×ª×§×™×Ÿ";
      return;
    }

    document.getElementById("login-screen").classList.add("hidden");
    document.getElementById("camera-screen").classList.remove("hidden");
  }

  // === 3. ×¤×ª×™×—×ª ××¦×œ××” ===
  function openCamera() {
    document.getElementById("cameraInput").click();
  }

  // === 4. ×˜×™×¤×•×œ ×‘×ª××•× ×” ×©× ×‘×—×¨×” ===
  document.getElementById("cameraInput").addEventListener("change", async function(event) {
    const file = event.target.files[0];
    if (!file) return;

    const forkliftName = document.getElementById("forkliftName").value.trim();
    const warehouse = document.getElementById("warehouseSelect").value;

    if (!forkliftName) {
      alert("×™×© ×œ×”×–×™×Ÿ ×©× ××œ×’×–×Ÿ");
      return;
    }

    // ×”××¨×ª ×ª××•× ×” ×œÖ¾Base64
    const reader = new FileReader();
    reader.onload = async function() {
      const base64Image = reader.result.split(",")[1];

      const payload = {
        image: base64Image,
        name: forkliftName,
        warehouse: warehouse
      };

      try {
        await fetch(API_URL, {
          method: "POST",
          body: JSON.stringify(payload),
          headers: { "Content-Type": "application/json" }
        });

        // ××¢×‘×¨ ×œ××¡×š ×”×¦×œ×—×”
        document.getElementById("camera-screen").classList.add("hidden");
        document.getElementById("success-screen").classList.remove("hidden");

      } catch (err) {
        alert("×©×’×™××” ×‘×©×œ×™×—×”: " + err);
      }
    };

    reader.readAsDataURL(file);
  });

  // === 5. ×—×–×¨×” ×œ×¦×™×œ×•× × ×•×¡×£ ===
  function backToCamera() {
    document.getElementById("success-screen").classList.add("hidden");
    document.getElementById("camera-screen").classList.remove("hidden");
  }

</script>

</body>
</html>

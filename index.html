<script>
  // ⭐ כתובת ה־API שלך (Apps Script)
  const API_URL = "https://script.google.com/macros/s/AKfycbyi4DpKBuQFvJGZt--n09oLZ46AHOke9P8UDB9y7kVya1V50p499c1hy2TM2jY85WU4EA/exec";

  async function login() {
    const phone = document.getElementById("phone").value.trim();
    const loader = document.getElementById("loader");

    if (phone.length < 10) {
      alert("מספר טלפון לא תקין");
      return;
    }

    loader.style.display = "block";

    try {
      // ⭐ שליחת POST תקינה ל־Apps Script
      const response = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          action: "verifyOTP",
          phone: phone
        })
      });

      // ⭐ קריאת JSON מהשרת
      const data = await response.json();

      if (!data.success) {
        alert("המספר לא מורשה במערכת");
        loader.style.display = "none";
        return;
      }

      const name = data.name || "";
      const token = data.token || "OK";

      // ⭐ מעבר לדשבורד
      window.location.href =
        `dashboard.html?token=${token}&name=${encodeURIComponent(name)}`;

    } catch (err) {
      console.log("שגיאה:", err);
      alert("שגיאה בחיבור לשרת");
    }

    loader.style.display = "none";
  }
</script>

<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>צילום תווית</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #1a1a1a;
      color: #ffffff;
      text-align: center;
      font-size: 22px;
    }

    /* ⭐ כותרת בסגנון 1 — מסגרת סימטרית */
    .banner-box {
      font-size: 42px;
      font-weight: bold;
      color: #ffffff;
      display: inline-block;
      padding: 12px 30px;
      border: 4px solid #ffffff;
      border-radius: 12px;
      margin-bottom: 25px;
      letter-spacing: 2px;
      text-align: center;
      white-space: pre;
    }

    #preview {
      width: 90%;
      max-width: 450px;
      margin-top: 20px;
      border: 3px solid #fff;
      border-radius: 12px;
      display: none;
    }

    button {
      margin: 20px;
      padding: 18px 32px;
      font-size: 28px;
      border: none;
      border-radius: 10px;
      background: #d32f2f;
      color: white;
      cursor: pointer;
      width: 80%;
      max-width: 350px;
    }

    #loader {
      display: none;
      font-size: 26px;
      margin-top: 20px;
    }
  </style>
</head>

<body>

  <!-- ⭐ כותרת חדשה בסגנון 1 -->
  <h2 class="banner-box">צילום תווית</h2>

  <input type="file" accept="image/*" capture="environment" id="cameraInput" style="display:none;" onchange="showPreview(event)">
  <button onclick="document.getElementById('cameraInput').click()">צלם תווית</button>

  <img id="preview">

  <div id="loader">מעבד את התמונה…</div>

  <button onclick="sendToServer()">שלח</button>

<script>
  const params = new URLSearchParams(window.location.search);
  const token = params.get("token");
  const name = params.get("name");
  const main = params.get("main");
  const finished = params.get("finished");

  if (!token) {
    alert("שגיאה: אין טוקן זיהוי");
    window.location.href = "index.html";
  }

  function showPreview(event) {
    const img = document.getElementById("preview");
    img.src = URL.createObjectURL(event.target.files[0]);
    img.style.display = "block";
  }

  function sendToServer() {
    const fileInput = document.getElementById("cameraInput");
    if (!fileInput.files.length) {
      alert("צלם תווית לפני השליחה");
      return;
    }

    document.getElementById("loader").style.display = "block";

    const formData = new FormData();
    formData.append("image", fileInput.files[0]);
    formData.append("token", token);
    formData.append("name", name);
    formData.append("main", main);
    if (finished) formData.append("finished", finished);

    fetch("upload.php", {
      method: "POST",
      body: formData
    })
    .then(r => r.text())
    .then(res => {
      document.getElementById("loader").style.display = "none";
      alert("התמונה נשלחה בהצלחה");
      window.location.href = "dashboard.html?token=" + token + "&name=" + encodeURIComponent(name);
    })
    .catch(err => {
      document.getElementById("loader").style.display = "none";
      alert("שגיאה בשליחה");
    });
  }
</script>

</body>
</html>
